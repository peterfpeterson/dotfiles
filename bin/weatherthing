#!/usr/bin/bash
txt_file=~/.cache/weather.txt
png_file=~/.cache/weather.png

# fetch the weather
# the sed command changes hh:mm:ss to hh:mm
~/bin/weather --conky | sed -r 's/([0-9]{2}:[0-9]{2}):[0-9]{2}/\1/g' > "${txt_file}" || exit 1
# add update timestamp
echo "      Updated $(date --iso-8601=minutes)" > "${txt_file}.tail"
# remove empty lines
sed -i '/^\s*$/d' "${txt_file}"

# convert to an image if the file isn't empty
if [ -s "${txt_file}" ]; then
    pango-view --background=transparent --foreground="#eeeeee" --font "FiraCode Nerd Font Mono" -qo "${png_file}" "${txt_file}" || exit 2
fi
