#!/bin/env bash
######################################################################
# convenience wrapper for calling https://github.com/chubin/wttr.in
######################################################################

help () {
    if [ -n "${1}" ]; then
        echo "Help from website"
        curl wttr.in/:help # help url
        echo ""
        echo "Help for bash script"
        echo ""
    fi

    local name # name of the script
    name=$(basename "${0}")
    echo "Usage: ${name}  [OPTION] [LOCATION]"
    echo "Show the weather using wttr.in"
    echo ""
    echo "Default behavior prints weather information in 3 lines"
    echo ""
    echo "  [LOCATION] will default to what IP lookup finds"
    echo "  -h, --help    print help and exit"
    echo "  -l, --long    long printing with graphs"
    echo "  -w, --wide    takes up a ton of space"
}

# this is called single line format, but many lines can be made
standard() {
    curl -s 'wttr.in/{Knoxville,Oak%20Ridge}?format=%l+%c+feels+like+%f+(%C+%t+%h+%w+%p)\n'
    curl -s 'wttr.in/Knoxville?format=%m+%D↗%S↑%z↓%s↘%d\n'
}

short() {
    curl -s wttr.in/"${1}"?format="%l+%c+feels+like+%f+(%C+%t+%h+%w+%p)\n%m+%D↗%S↑%z↓%s↘%d\n"
}

version2() {
    curl wttr.in/"${1}"?format=v2d
}

traditional() {
    curl wttr.in/"${1}?F_2"
}

report="standard"
# parse options
loc=""
while [ -n "${1}" ]; do
    case "${1}" in
        -h)
            help
            exit 0
            ;;
        --help)
            help "long"
            exit 0
            ;;
	-s|--short)
	    report="short"
	    ;;
        -w|--wide)
            report="wide"
            ;;
        -l|--long)
            report="long"
            ;;
        *)
            loc="${1}"
	    if [ "${report}" = "standard" ]; then
	       report=short
	    fi
            ;;
    esac
    shift
done

# show the right thing
case "${report}" in
    long) version2 "${loc}" ;;
    short) short "${loc}";;
    standard) standard ;;
    wide) traditional "${loc}" ;;
esac
